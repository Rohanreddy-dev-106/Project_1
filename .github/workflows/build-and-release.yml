name: Build and Release

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
    
    - name: Compile Java files
      run: javac *.java
      
    - name: Create JAR file
      run: |
        echo "Main-Class: App" > MANIFEST.MF
        jar cfm movie-management-system.jar MANIFEST.MF *.class
        
    - name: Test application (basic validation)
      run: |
        java App < /dev/null || true
        echo "Build completed successfully"
    
    - name: Create Release
      if: github.ref == 'refs/heads/main' && github.event_name == 'push'
      uses: softprops/action-gh-release@v1
      with:
        tag_name: prerelease-${{ github.run_number }}
        name: Movie Management System - Prerelease ${{ github.run_number }}
        body: |
          ðŸŽ¬ **Movie Management System - Automatic Prerelease**
          
          This is an automatically generated prerelease of the Movie Management System.
          
          ## Features:
          - Complete DSA implementation (ArrayList, LinkedList, Stack, Queue, BST, Priority Queue)
          - Multiple search algorithms (Linear, Binary, BST Search)
          - Multiple sorting algorithms (Bubble, Merge, Quick Sort)
          - Interactive movie management with watch history and queue
          
          ## How to run:
          1. Download the JAR file
          2. Run: `java -jar movie-management-system.jar`
          
          Build #${{ github.run_number }} - ${{ github.sha }}
        draft: false
        prerelease: true
        files: movie-management-system.jar
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}